export class Orbs{ctx;params;quizParams;constructor(t,i){this.ctx=t.getContext("2d"),this.quizParams=i,this.params=this.quizParams.canvasParams,t.height=this.params.height,t.width=this.params.width,this.ctx.fillStyle=this.params.bg,this.ctx.fillRect(0,0,this.params.width,this.params.height)}drawHeader(t){this.ctx.textAlign="left",this.ctx.fillStyle=this.params.fg,this.ctx.font=this.params.titleFont,this.ctx.fillText(t.title,20,100,this.params.width-160),this.ctx.textAlign="right",this.ctx.font=this.params.bodyFont;const i=this.params.width-20;this.ctx.fillText(t.url,i,40),this.ctx.fillText(t.version,i,70),this.ctx.fillText(t.edition,i,100)}drawCircle(t,i,s,e=this.params.fg){this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t,i,s,0,2*Math.PI),this.ctx.fill()}checkValue(t){return Number.isInteger(t)&&t>-1&&t<7}async drawImage(t,i,s){const e=new Image;return e.src="./assets/icons/"+t,new Promise(((t,a)=>{e.addEventListener("load",(()=>{this.ctx.drawImage(e,i-40,s-40,80,80),t()})),e.addEventListener("abort",(t=>{a(t)}))}))}drawAxis(t,i){const s=250+175*this.quizParams.axes.indexOf(t),e=this.params.width-250;this.ctx.fillStyle=this.params.fg,this.ctx.fillRect(125,s,e,4);const a=new Array(7).fill(0).map(((t,i)=>125+e/6*i));for(const[i,e]of a.entries()){this.drawCircle(e,s,12);const a=this.quizParams.colors[t][i];this.drawCircle(e,s,8,a)}if(this.checkValue(i)){const e=a[i],r=this.quizParams.colors[t][i],c=this.quizParams.labels[t][i];this.ctx.textAlign="center",this.ctx.font=this.params.bodyFont,this.ctx.fillStyle=this.params.fg,this.ctx.fillText(c,e,s-70,225),this.drawCircle(e,s,60),this.drawCircle(e,s,52,r);const h=this.quizParams.images[t][i];return this.drawImage(h,e,s)}return new Promise((t=>t()))}drawAll(t,i){this.drawHeader(t);const s=[];for(const[t,e]of Object.entries(i)){if(!this.checkValue(e))throw new Error(`Invalid score: ${t}: ${e}`);s.push(this.drawAxis(t,e))}return Promise.all(s)}static downloadCanvas(t){const i=document.createElement("a"),s=(new Date).toISOString();i.download=`${document.title}-${s}.png`,i.href=t.toDataURL("image/png"),i.click()}}export function cleanUrl(t,i=null){let s=t.search?t.href.split(t.search)[0]:t.href;s=s.replace(/^https?\:\/\//gim,""),s=s.replace(/\/$/gim,"");const e=new RegExp(`/${i}(.htm[l]?)?$`,"gmi");return s.match(e)&&(s=s.replace(e,"")),s}export function b64enc(t){const i=(new TextEncoder).encode(t);return window.btoa(String.fromCharCode(...i))}export function b64dec(t){const i=window.atob(t),s=new Uint8Array([...i].map(((t,s)=>i.charCodeAt(s))));return new TextDecoder("utf-8").decode(s)}